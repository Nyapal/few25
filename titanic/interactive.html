<html>
  <head>
    <title> Viz 3 | Interactive </title>
    <link rel="stylesheet" href="titanic2.css">
    <style> 
      #button-selected {
        background-color: skyblue !important;
      }
    
    </style>
  </head>
  <body>
    <h1> Viz 3 </h1>

    <h3> Gender </h3>
    <div id="main"></div>
    <button id="btnGender"> Gender </button>
    <button id="btnSurvivors"> Survivors </button>
    <button id="btnEmbarked"> Embarked </button>
    <script>

    fetch('passengers.json')
    .then(res => res.json())
    .then(json => {
      handleData(json)
    })

    const main = document.getElementById('main')
    const elements = []
    const passengerData = []

    let showGender = false
    let showSurvivors = false
    let showEmbarked = false

    function handleData(data) {
      const fields = data.map(({ fields }) => fields)

      fields.forEach((passenger, i) => {
        const el = document.createElement('div')
        main.appendChild(el)
        //styling element 
        el.style.width = '20px'
        el.style.height = '20px'
        el.style.margin = '1px'
        el.style.backgroundColor = 'black'
        el.style.transition = '3s'
        elements.push(el)             // store the element
        passengerData.push(passenger) // Store the passenger
      });

      btnGender.addEventListener('click', (e) => {
        showGender = !showGender
        if (showGender) {
          // true
          passengerData.forEach((passenger, i) => {
            elements[i].style.backgroundColor = passenger.sex === 'male' ? '#000080' : 'pink'
          })
        } else {
          // false
          passengerData.forEach((passenger, i) => {
            elements[i].style.backgroundColor = 'black'
          })
        }
      })

      btnSurvivors.addEventListener('click', (e) => {
        showSurvivors = !showSurvivors
        if (showSurvivors) {
          passengerData.forEach((passenger, i) => {
            elements[i].style.border = passenger.survived === 'No' ? ' 2px solid #B22222' : '2px dashed #000080'
          })
          e.target.classList.add('button-selected')
        } else {
          passengerData.forEach((passenger, i) => {
            elements[i].style.transition = '4s'
            elements[i].style.border = '0px solid black'
          })
          e.target.classList.remove('button-selected')
        }
      })

      btnEmbarked.addEventListener('click', (e) => {
        showEmbarked = !showEmbarked
        if (showEmbarked) {
          passengerData.forEach((passenger, i) => {
            if (passenger.embarked === 'S') {
              elements[i].style.backgroundColor = '#B22222'
            } else if (passenger.embarked === 'Q') {
              elements[i].style.backgroundColor = '#000080'
            } else if (passenger.embarked === 'C') {
              elements[i].style.backgroundColor = 'silver'
            } else {
              elements[i].style.backgroundColor = 'black'
            }
          })
        }
      })

    }
    </script>
  </body>
</html>